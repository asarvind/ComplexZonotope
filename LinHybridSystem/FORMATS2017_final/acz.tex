We now introduce an \emph{augmented complex zonotope}, which is a
Minkowski sum of a template complex zonotope and a real zonotope. In
terms of expressivity, an augmented complex zonotope is slightly more
general than template complex zonotopes.  But geometrically, the sets
that can be described as real projections of augmented complex
zonotopes can also be described as real projections of template
complex zonotopes.  However, with augmented complex zonotopes, the
intersection with subparallelotopic constraints can be succinctly
specified, as we will see latter. Consequently, this representation is
more convenient to derive conditions for computing invariants for the
affine hybrid system.
%
\begin{definition}[Augmented complex zonotope]
Let $V\in\mat{n}{m}{C}$ called primary template, $W\in\mat{n}{k}{R}$
called secondary template, $c\in\mb{R}^n$ called primary offset,
$s\in\mb{R}^m$ called scaling factors, $u,l\in\mb{R}^k$ called lower
and upper interval bounds, respectively, such that $l\leq u$.  The
following is an augmented complex
zonotope
\begin{equation*}
\gcz{V}{c}{s}{W}{l}{u} = \cz{V}{c}{s}\oplus\zon{W}{l}{u}.
\end{equation*}
\end{definition}
%
We first discuss the intersection operation of an augmented complex
zonotope with sub-parallelotopic constraints, before disucssing other
operations.  Note that due to the space limit, we do not include all
the proofs but only those of the key results.  

For deriving a formula for the intersection, we first prove some
results on intersection among convex sets. Let us define the support
of a vector $v$ in a set $S\subset\realset^n$ relative to a point
$w\in\realset^n$ as $\support{w}{v}{S}=\max_{x\in S}v^T\lt(x-w\rt)$.
The following lemma states a relationship between the support of
vectors and inclusion between sets.
%
\begin{lemma}~\label{supp-inclusion}
Let $S_1,S_2\subseteq \realset^n$ be two closed convex sets such that
$S_1\bigcap S_2\neq \emptyset$.  Let $w\in S_1\bigcap S_2$.
Then $S_1\subseteq S_2$ iff $\forall
v\in\realset^n:~\support{w}{v}{S_1}\leq \support{w}{v}{S_2}$.
\end{lemma}
Let us say that two convex and closed sets $S_1$ and $S_2$ have
non-empty intersection and $w$ is a common point, i.e., inside the
sets.  According to the above lemma, saying that $S_1$ is contained
inside $S_2$, is equivalent to saying that the maximum possible
displacement in $S_1$ from $w$ along the direction of any
vector $v$ is less than the maximum possible displacement in $S_2$
from $w$ along the direction of the vector $v$.

Recall that an augmented complex zonotope is a Minkowski sum of a
complex zonotope and a real zonotope, i.e.,
$\cz{V}{c}{s}\oplus\zon{W}{l}{u}$.  From Lemma~\ref{lem:motivation},
we see that the intersection of a sub-parallelotope
$\sptope{K}{\wh{l}}{\wh{u}}$ with a zonotope $\zon{W}{l}{u}$ can be
computed when $W=\pinv{K}$.  Motivated by this, we want to
find a condition under which we can overapproximate the intersection
$\lt(\cz{V}{c}{s}\oplus\zon{W}{l}{u}\rt)\bigcap\sptope{K}{\wh{l}}{\wh{u}}$
by
$\cz{V}{c}{s}\oplus\lt(\zon{W}{l}{u}\bigcap\sptope{K}{\wh{l}}{\wh{u}}\rt)$,
that is computing first the intersection (which can be done
efficiently) and then the Minkowski sum.  Indeed we can find the
required condition for a more general case of any three closed convex
sets $S_1,S_2,S_3$ (that is, find a condition under which
$\lt(S_1\oplus S_2\rt)\bigcap S_3$ can be overapproximated by
$S_1\oplus\lt(S_2\bigcap S_3\rt)$) and apply this result to augmented
complex zonotopes. We state this condition as follows.
%
\begin{lemma}~\label{gen-int}
Let $S_1\subseteq \complexset^n$ and $S_2,S_3\in\realset^n$ be closed
convex sets such that $S_2\cap S_3\neq \emptyset$ and $0\in S_1$.
Then $\lt(S_1\oplus S_2\rt)\bigcap S_3\subseteq S_1\oplus\lt(S_2\cap
S_3\rt)$.
\end{lemma}
\begin{proof}
Firstly, the imaginary parts of both sides of above inequality are
equal to $\img(S_1)$ because $\img(S_2)=\img(S_3)=0$. So, we show the
inclusion of real parts.  Let $w\in S_2\bigcap S_3 $.  Then, since
$0\in S_1$, so $w=w+0\in S_1\oplus S_2\imp w\in
\lt(\real\lt(S_1\rt)\oplus S_2\rt)\bigcap S_3$.  So, based on
Lemma~\ref{supp-inclusion}, it sufficient to prove that for all
$v\in\realset^n$, $$\support{w}{v}{\lt(\real\lt(S_1\rt)\oplus
  S_2\rt)\bigcap S_3}\leq
\support{w}{v}{\real\lt(S_1\rt)\oplus\lt(S_2\cap S_3\rt)}.$$ Let us
define $a = \support{0}{v}{\real\lt(S_1\rt)}$, $b=\support{w}{v}{S_2}$
and $c = \support{w}{v}{S_3}$.  Since, $0\in\real\lt(S_1\rt)$, so
$a=\max_{x\in\real\lt(S_1\rt)}v^Tx\geq v^T0 =0$, i.e., $a\geq 0$.
Furthermore, $\support{w}{v}{\lt(\real\lt(S_1\rt)\oplus S_2\rt)\bigcap
  S_3}$ $= \min\lt(\support{w}{v}{\real\lt(S_1\rt)\oplus
  S_2},\support{w}{v}{S_3}\rt)$.  As $w=w+0$, so the above equals
$\min\lt(\support{0}{v}{\real\lt(S_1\rt)}+\support{w}{v}{S_2},\support{w}{v}{S_3}\rt)
= \min(a+b,c)$.  By a similar calculation, we can show
$\support{w}{v}{\real\lt(S_1\rt)\oplus\lt(S_2\cap S_3\rt)} =
a+min(b,c)$.  So, we need to prove that $\min(a+b,c)\leq a+min(b,c)$.
Since $a\geq 0$, so $\min(a+b,c)\leq \min(a+b,a+c) =
a+\min(b,c)$. \qed
\end{proof}

Now we introduce the following \emph{affine} functions which are used latter to
express the overapproximation of the intersection between an augmented
complex zonotope and a sub-parallelotope.
%
A binary function
$\minaffinefunc:\realset^k\times\comprealset^k,$
called \emph{min-approximation} function, is defined as follows: for
$u\in\realset^k$ and $\wh{u}\in\comprealset^k$,
$\lt(\minaffine{u}{\wh{u}}\rt)_i = \left\{
\begin{array}{l}
\wh{u}_i~~\text{if}~\wh{u}_i<\infty\\
u_i~~\text{if}~\wh{u}_i=\infty
\end{array}
\right..$
Similarly, another binary function       
$\maxaffinefunc:\realset^k\times\comprealset^k$,
called \emph{max-approximation} function, is defined as follows: for
$l\in\realset^k$ and $\wh{l}\in\comprealset^k$,
$\lt(\maxaffine{l}{\wh{l}}\rt)_i = \left\{
\begin{array}{l}
\wh{l}_i~~\text{if}~\wh{l}_i>\infty\\
l_i~~\text{if}~\wh{l}_i=-\infty
\end{array}
\right..$
It is easy to see that the min-approximation and max-approximation functions are affine, because for any one coordinate, a respective function is either a constant function or equal to the first argument, i.e, identity function.
%
The following theorem states that an overapproximation of the intersection
of an augmented complex zonotope with a sub-parallelotope can be
expressed using these affine approximation functions.
%
\begin{theorem}~\label{thm:acz-int}
Given a sub-parallelotope $\sptope{\ptemplate}{\wh{l}}{\wh{u}}$ and an
augmented complex zonotope $\gcz{V}{c}{s}{\pinv{\ptemplate}}{l}{u}$
such that $V\conjtranspose{V}$ is non-singular, $\lt|\pinv{V}c\rt|\leq s$, $l\leq
\maxaffine{l}{\wh{l}}\leq \minaffine{u}{\wh{u}}\leq u$, then
$\gcz{V}{c}{s}{\pinv{\ptemplate}}{l}{u}\bigcap\sptope{\ptemplate}{\wh{l}}{\wh{u}}\subseteq
\gcz{V}{c}{s}{\pinv{\ptemplate}}{\maxaffine{l}{\wh{l}}}{\minaffine{u}{\wh{u}}}$.
%
\end{theorem}
\emph{Proof Sketch.}  Consider $S_1 = \cz{V}{c}{s}$, $S_2 =
\zon{\pinv{\ptemplate}}{l}{u}$ and $S_3 =
\sptope{\ptemplate}{\wh{l}}{\wh{u}}$.  First, we check that $0\in S_1$
and $S_2\bigcap S_3\neq \emptyset$, and then we subsitute $S_1$, $S_2$
and $S_3$ in Lemma~\ref{gen-int}.  To compute the intersection
between $S_2$ and $S_3$, we use Lemma~\ref{lem:motivation}.  %% The
%% detailed proof is in the appendix.
\qed


%
%% To illustrate, the intersection of $\gcz{\lt[\begin{array}{cc}1+2i &
%% 2+i\\1-2i & 2-i\\0 &
%% 0\end{array}\rt]}{\lt[\begin{array}{c}1\\1\\0\end{array}\rt]}{\lt[\begin{array}{c}1\\1\\1\end{array}\rt]}
%% {\lt[\begin{array}{c}0\\0\\1\end{array}\rt]}{-2}{2}$. with a
%% constraint on the third coordinate $-1\leq x_3\leq 1$ is exactly\\
%% $\gcz{\lt[\begin{array}{cc}1+2i & 2+i\\1-2i & 2-i\\0 &
%% 0\end{array}\rt]}{\lt[\begin{array}{c}1\\1\\0\end{array}\rt]}{\lt[\begin{array}{c}1\\1\\1\end{array}\rt]}
%% {\lt[\begin{array}{c}0\\0\\1\end{array}\rt]}{-1}{1}$.  We observe that
%% the center $\lt(\begin{array}{c}1\\1\\0\end{array}\rt)$ is
%% perpendicular to the third axis, i.e., the vector
%% $\lt[\begin{array}{ccc}0 & 0 & 1\end{array}\rt]$, which is a required
%% condition in the above lemma.  Furthermore, since the primary template
%% is orthogonal to the subparallelotopic template in this example, i.e.
%% $\lt[\begin{array}{ccc}0 & 0 &
%% 1\end{array}\rt]\lt[\begin{array}{cc}1+2i & 2+i\\1-2i & 2-i\\0 &
%% 0\end{array}\rt]=0$, the resultant intersection is exactly an
%% augmented complex zonotope.  On the other hand, if the primary
%% template is not orthogonal with the secondary template, like in the
%% case of $\gcz{\lt[\begin{array}{cc}1+2i & 2+i\\1-2i & 2-i\\1 &
%% 1\end{array}\rt]}{\lt[\begin{array}{c}1\\1\\0\end{array}\rt]}{\lt[\begin{array}{c}1\\1\\1\end{array}\rt]}
%% {\lt[\begin{array}{c}0\\0\\1\end{array}\rt]}{-2}{2}$, then the
%% intersection with $-1\leq x_3\leq 1$ is overapproximated by
%% $\gcz{\lt[\begin{array}{cc}1+2i & 2+i\\1-2i & 2-i\\1 &
%% 1\end{array}\rt]}{\lt[\begin{array}{c}1\\1\\0\end{array}\rt]}{\lt[\begin{array}{c}1\\1\\1\end{array}\rt]}
%% {\lt[\begin{array}{c}0\\0\\1\end{array}\rt]}{-1}{1}$, but this is not
%% the exact intersected set.


Similar to usual zonotopes, augmented
complex zonotopes are closed under Minkowski sums and linear
transformations, and their computations are also similar. The computation of some important operations are summarized as follows.

\begin{enumerate}
\item $A\gcz{V}{c}{s}{W}{l}{u} = \gcz{AV}{Ac}{s}{AW}{l}{u}$.
\item Given $\mathcal{G}_1=\gcz{V}{c}{s}{W}{l}{u}$ and $\mathcal{G}_2=\gcz{V^\pr}{c^\pr}{s^\pr}{W^\pr}{l^\pr}{u^\pr}$, we have $\mathcal{G}_1 \oplus \mathcal{G}_2= \gcz{\lt[V~V^\pr\rt]}{c+c^\pr}{\ColumnJoin{s}{s^\pr}}{\lt[W~W^\pr\rt]}{\ColumnJoin{l}{l^\pr}}{\ColumnJoin{u}{u^\pr}}.$

%
\item The limits of the projection of an augmented complex zonotope along
any direction can be computed as follows. For $v\in\realset^n$,
\begin{equation}\label{lem:polylimits-acz}
\max_{x\in\gcz{V}{c}{s}{W}{l}{u}}v^Tx = v^T\lt(c+W\frac{l+u}{2}\rt)+\lt|v^T[V~W]\rt|\lt(\ColumnJoin{s}{\frac{u-l}{2}}\rt)
\end{equation}
\end{enumerate}
%
%\begin{lemma}[Linear transformation and Minkowski sum]
%\begin{enumerate}
%\item $A\gcz{V}{c}{s}{W}{l}{u} = \gcz{AV}{Ac}{s}{AW}{l}{u}$.
%\item $\gcz{V}{c}{s}{W}{l}{u}\oplus
%  \gcz{V^\pr}{c^\pr}{s^\pr}{W^\pr}{l^\pr}{u^\pr}$\\
%$= \gcz{\lt[V~~V^\pr\rt]}{c+c^\pr}{\ColumnJoin{s}{s^\pr}}{\lt[W~~W^\pr\rt]}{\ColumnJoin{l}{l^\pr}}{\ColumnJoin{u}{u^\pr}}$
%\end{enumerate}
%\end{lemma}
%%
%The limits of the projection of an augmented complex zonotope along
%any direction are stated in the following lemma.
%%
%\begin{lemma}~\label{lem:polylimits-acz}
%Let $V\in\mat{n}{m}{\mb{C}}$ and $v\in\realset^n$.  Then,
%\[
%\max_{x\in\gcz{V}{c}{s}{W}{l}{u}}v^Tx = v^T\lt(c+W\frac{l+u}{2}\rt)+\lt|v^T[V~~W]\rt|\lt(\ColumnJoin{s}{\frac{u-l}{2}}\rt)
%\]
%\end{lemma}
%%%%%%%%%%%
To derive~(\ref{lem:polylimits-acz}), we multiply the linear
constraints with the center of the augmented complex zonotope and add
an error term proportional to a set of scaling factors.  The center is
$\lt(c+W\frac{l+u}{2}\rt)$, while the scaling factors are
$\ColumnJoin{s}{\frac{u-l}{2}}$.  Based
on~(\ref{lem:polylimits-acz}), we derive the following Lemma relating
the real projection of an augmented complex zonotope and a template
complex zonotope. 
%
\begin{lemma}~\label{lem:conversion}
$\real\lt(\gcz{V}{c}{s}{W}{l}{u}\rt) = \real\lt(\cz{\lt[V~W\rt]}{c+W\lt(\frac{u+l}{2}\rt)}{\ColumnJoin{s}{\frac{u-l}{2}}}\rt)$.
\end{lemma}
%
Because of the above relationship, checking the inclusion between the
real projections of two augmented complex zonotopes amounts to
checking the inclusion between real projections of two template
complex zonotopes.  Therefore, we first review an inclusion relation
between template complex zonotopes, which was earlier stated
in~\cite{tcz2017}.

Unlike usual zonotopes, template complex zonotopes can have
non-polyhedral real projections.  Checking the exact inclusion between
two template complex zonotopes, in general, amounts to solving a
non-convex optimization problem, which could be computationally
intractable.  Instead, a convex condition was proposed
in~\cite{tcz2017}, which is sufficient to guarantee the inclusion
between template complex zonotopes.  Here, we present this condition
as a relation between template complex zonotopes.
%
\begin{definition}
We define a relation ``$\order$'' between template complex zonotopes
as\\ $\cz{V^\pr_{n\times m^\pr}}{c^\pr}{s^\pr}\order \cz{V_{n\times
    m}}{c}{s}$ if all of the below statements are collectively true.
\begin{align}~\label{eqn:tcz-inc}
\begin{split}
& \exists X\in\mat{m}{m^\pr}{\mb{C}}~\text{and}~y\in\mb{C}^{m}~\text{s.t.}\\
& \transfer{V}{V^\pr}{s^\pr}{X},~~~\centertransfer{V}{c}{c^\pr}{y},~\text{and}~
 \scalebound{X}{y}{s}{m}{m^\pr}\leq 0\\
\end{split}
\end{align}
\end{definition}
%
\begin{lemma}[Inclusion: template complex
  zonotopes]~\label{lem:zon-zon} The
inclusion $\cz{V^\pr}{c^\pr}{s^\pr}\subseteq \cz{V}{c}{s}$ holds if
the relation $\cz{{V^\pr}}{c^\pr}{s^\pr}\order \cz{V}{c}{s}$ is true.
\end{lemma}
\emph{Proof idea.}
We relate the combining
coefficients of the two template complex zonotopes by a linear
transformation, with appropriate bounds on the transformation matrix
such that the inclusion holds.\qed

We extend the above inclusion relation to augmented complex zonotopes,
based on Lemma~\ref{lem:conversion} as follows.
%
\begin{definition}~\label{defn:gcz-order}
We say that $\gcz{V^\pr}{c^\pr}{s^\pr}{W^\pr}{l^\pr}{u^\pr}\order
\gcz{V}{c}{s}{W}{l}{u}$ if\\ $\cz{\lt[V^\pr~W^\pr\rt]}{c^\pr+W^\pr\lt(\frac{u^\pr+l^\pr}{2}\rt)}{\ColumnJoin{s^\pr}{\frac{u-l}{2}}}
\order
\cz{\lt[V~W\rt]}{c+W\lt(\frac{u+l}{2}\rt)}{\ColumnJoin{s}{\frac{u-l}{2}}}.$
\end{definition}
%
\begin{lemma}[Inclusion between augmented complex
    zonotopes]~\label{lem:gcz-gcz} The real inclusion\\
$\real\lt(\gcz{V^\pr}{c^\pr}{s^\pr}{W^\pr}{l^\pr}{u^\pr}\rt)\subseteq \real\lt(\gcz{V}{c}{s}{W_{n\times
k}}{l}{u}\rt)$ holds if the relation\\
$\gcz{V^\pr}{c^\pr}{s^\pr}{W^\pr}{l^\pr}{u^\pr}\order \gcz{V}{c}{s}{W}{l}{u}$ is true.
\end{lemma}


For fixed $V$ and $V^\pr$, we observe that~(\ref{eqn:tcz-inc}) is
equivalent to a set of convex constraints called second order
conic constraints.
%
%\begin{definition}[SOCC]
Recall that a constraint of the form $\|Ax\|_{2}+v^Tx+w\leq 0$ on an $n$-dimensional
variable $x$, given $A\in\mat{n}{k}{\realset}$, $v\in\realset^n$ and $w\in\realset$, is
a second order conic constraint (SOCC).
%\end{definition}
%
We also note that linear inequalities and equalities can be expressed
in the form of SOCC described above. There are many convex optimization tools that can efficiently solve
SOCC up to a high numerical precision. Our aforementioned observation
about~(\ref{eqn:tcz-inc}) is extended to augmented
complex zonotopes and formalized as below.
%
\begin{proposition}~\label{lem:zon-socc}
For constant $V$,$V^\pr$,$W$,$W^\pr$, the relation\\
$\gcz{V^\pr}{c^\pr}{s^\pr}{W^\pr}{l^\pr}{u^\pr}\order \gcz{V}{c}{s}{W}{l}{u}$ is equivalent to a set of second order conic constraints on
the variables $c,c^\pr,s,s^\pr,l,l^\pr,u,u^\pr$ and some additional
variables.
\end{proposition}
%













