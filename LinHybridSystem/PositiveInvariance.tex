  So, let us define the
following functions 


Then a state set is positively invariant if the reachable set in one
step by both the intralocation and interlocation dynamics is contained
within the state set.


Our objective is to find positive invariants whose projection in any
location is a generalized complex zonotope.  We use a template based
approach where we first fix the primary and secondary template in each
location $\loc\in\locationset$ as as $V(\loc)\in\mat{n}{m(q)}{\mb{C}}$
and $W(\loc) = \lt[\sectemp{\loc}\rt]$, respectively.  The secondary
template is chosen as above so that intersection with the
sub-parallelotopic staying and guard conditions can be conveniently
computed, based on Lemma~\ref{lem:intersection}.  Next, we
try to find corresponding primary offsets, scaling factors
and sub-parallelotopic bounds of the generalized complex zonotopic
projections in all locations so that the state set so defined is
positively invariant.

To this end, we state the following lemmas for the inclusion relations
in~\ref{eqn:PosInv} to be satisfied.
\begin{lemma}
  Let  
  us consider a state set $\hybridset$ whose projection in in each
  location $\loc\in\locationset$ is $\hybridset(\loc) =
  \gcz{V(\loc)}{c(\loc)}{s(\loc)}{W(\loc)}{l(\loc)}{u(\loc)}$ where
  $W(\loc)={\lt[\sectemp{\loc}\rt]}$.  Let us consider that the additive input in each location
  $\loc\in\locationset$ can be overapproximated as $\inputset(\loc) = \cz{B_{n\times
      m^\pr(q)}(\loc)}{b(\loc)}{r(\loc)}$.  Then
   $\locationtransition{\loc}\lt(\hybridset(\loc)\rt)
  \subseteq \hybridset\lt(\loc\rt)$ holds if,
\begin{align}
\begin{split}
& \exists
  X(\loc)\in\mat{\lt(m(\loc)+k(\loc)\rt)}{\lt(m(\loc)+k(\loc)+m^\pr(\loc)\rt)}{\mb{C}},~
  y(\loc)\in\mb{C}^{m(\loc)+k(\loc)}\\&~u^\pr(\loc),l^\pr(\loc)\in\realset^{k(\loc)}~\text{and}~s^\pr(\loc)\in\realset^{k(\loc)}~\text{such
    that}:
\end{split}\\
\begin{split}
& \left[V(\loc),~W(\loc)\rt]X(\loc) =
  [AV(\loc),~AW(\loc),~B(\loc)]\dg\lt(\cjoin{s(\loc)}{s^\pr(\loc)}{r(\loc)}\rt),\\
\end{split}\\
\begin{split}
& s^\pr(\loc) = \frac{\minaffine{\stay^+(\loc)}{u(\loc)}
      -\maxaffine{\stay^-(\loc)}{l(\loc)}}{2},
\end{split}\\
\begin{split}
  & \left[V(\loc),~~W(\loc)\rt]y(\loc) = 
    \map(\loc)\lt(c(\loc)+W(\loc)\frac{\minaffine{\stay^+(\loc)}{u(\loc)}
     +\maxaffine{\stay^-(\loc)}{l(\loc)}}{2}\rt)\\ & \hspace{10em} +
  b(\loc)-c(\loc)-W(\loc)\frac{u^\pr(\loc)+l^\pr(\loc)}{2},
\end{split}\\
\begin{split}
& \forall
i\in\tup{m(\loc)},~\lt|y_i(\loc)\rt|+\sum_{i=1}^{m(\loc)+k(\loc)+m^\pr(\loc)}\lt|X_{ij}(\loc)\rt|\leq
s_i(\loc),
\end{split}\\
\begin{split}
& \forall
i\in\lt\{m(\loc)+1,...,m(\loc)+k(\loc)\rt\},\\
&\lt|y_i(\loc)\rt|+\sum_{i=1}^{m(\loc)+k(\loc)+m^\pr(\loc)}\lt|X_{ij}(\loc)\rt|\leq
\frac{u^\pr(\loc)-l^\pr(\loc)}{2},
\end{split}\\
& l^\pr(\loc)\leq u^\pr(\loc),\\
\begin{split}
& \maxaffine{l^\pr(\loc)}{\stay^-(\loc)}\geq
l(\loc)~\text{and}~\minaffine{u^\pr(\loc)}{\stay^+(\loc)}\leq u(\loc).
\end{split}
\end{align}
\end{lemma}

\begin{lemma}
  Let us consider a state set $\hybridset$ whose projection in each location
  $\loc\in\locationset$ is $\hybridset(\loc) =
  \gcz{V(\loc)}{c(\loc)}{s(\loc)}{W(\loc)}{l(\loc)}{u(\loc)}$ where
  $W(\loc)={\lt[\sectemp{\loc}\rt]}$.  Then for any edge
  $\edge\in\edgeset$, $\edgetransition{\edge}\lt(\hybridset\lt(\preloc{\edge}\rt)\rt) \subseteq
  \hybridset\lt(\postloc{\edge}\rt)$
    holds if the following is true.
\begin{align}
\begin{split}
& \exists X(\edge)\in
\mat{\lt(m\lt(\postloc{\edge}\rt)+k\lt(\postloc{\edge}\rt)\rt)}{\lt(m\lt(\preloc{\edge}\rt)+k\lt(\preloc{\edge}\rt)\rt)}{\mb{C}}~\text{and}~y(\edge)\in
\mb{C}^{m\lt(\preloc{\edge}\rt)+k\lt(\preloc{\edge}\rt)},\\
& \exists u^\pr(\edge),l^\pr(\edge)\in \realset^{k\lt(\postloc{\edge}\rt)}, c^\pr(\sigma)\in\mb{R}^n~\text{and}~s^\pr(\edge)\in\realset^{k\lt(\preloc{\edge}\rt)}~\text{s.t.}
\end{split}\\
\begin{split}
& \lt[V\lt(\postloc{\edge}\rt),~W\lt(\postloc{\edge}\rt)\rt]X(\edge) = \reset{\edge}\lt[V\lt(\preloc{\edge}\rt),~W\lt(\preloc{\edge}\rt)\rt]\dg
\ColumnJoin{s\lt(\preloc{\edge}\rt)}{s^\pr(\edge)}\\
\end{split}
\end{align}
\begin{align}
\begin{split}
s^\pr(\edge) = \frac{\minaffine{u\lt(\preloc{\edge}\rt)}{\min\lt(\stay^+\lt(\preloc{\edge},\edge^+\rt)\rt)}-
\maxaffine{l\lt(\preloc{\edge}\rt)}{\max\lt(\stay^-\lt(\preloc{\edge},\edge^-\rt)\rt)}}{2},\\
\end{split}
\end{align}
\begin{align}
\begin{split}
& \lt[V\lt(\postloc{\edge}\rt),~W\lt(\postloc{\edge}\rt)\rt]y(\edge) = \reset{\edge}\lt(c\lt(\preloc{\edge}\rt)+c^\pr(\edge)\rt)- 
c\lt(\postloc{\edge}\rt) - W\lt(\postloc{\edge}\rt)\frac{u^\pr\lt(\edge\rt)+l^\pr\lt(\edge\rt)}{2},\\
\end{split}
\end{align}
\begin{align}
\begin{split}
& c^\pr(\edge) = W\lt(\preloc{\edge}\rt)\frac{\minaffine{u\lt(\preloc{\edge}\rt)}{\min\lt(\stay^+\lt(\preloc{\edge},\edge^+\rt)\rt)}+
\maxaffine{l\lt(\preloc{\edge}\rt)}{\max\lt(\stay^-\lt(\preloc{\edge},\edge^-\rt)\rt)}}{2}
\end{split}
\end{align}
\begin{align}
\begin{split}
& \forall i\in \tup{m\lt(\postloc{\edge}\rt)}:
 \lt|y_i\rt|+\sum_{j=1}^{m\lt(\preloc{\edge}\rt)+k\lt(\preloc{\edge}\rt)}\lt|X_{ij}\rt|\leq s_i\lt(\postloc{\edge}\rt)
\end{split}\\
\begin{split}
& \forall i\in
\lt\{m\lt(\postloc{\edge}\rt)+1,...,m\lt(\postloc{\edge}\rt)+k\lt(\postloc{\edge}\rt)\rt\}:
\lt|y_i\rt|+\sum_{j=1}^{m\lt(\preloc{\edge}\rt)+k\lt(\preloc{\edge}\rt)}\lt|X_{ij}\rt|\leq \frac{u^\pr_i\lt(\edge\rt)+l^\pr_i\lt(\edge\rt)}{2}
\end{split}\\
\begin{split}
l^\pr(\edge)\leq u^\pr(\edge)
\end{split}\\
& \maxaffine{l^\pr(\edge)}{\stay^-\lt(\postloc{\edge}\rt)}\geq
l\lt(\postloc{\edge}\rt)~\text{and}~\minaffine{u^\pr(\edge)}{\stay^+\lt(\postloc{\edge}\rt)}\leq u\lt(\postloc{\edge}\rt).
\end{align}
\end{lemma}
