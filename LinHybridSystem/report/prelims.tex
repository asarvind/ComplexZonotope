
In a discrete-time affine hybrid system, we have a finite set of
discrete variables, called locations, and a finite set of continuous
variables whose valuation is in the real Euclidean space of dimension
$n\in\pint$.  In each location, there are a set of linear constraints,
called \emph{staying conditions}, within which the continuous state of
the system in that location is constrained.  Furthermore, there is
an affine transition map with (possibly) additive uncertain but
bounded disturbance input specifying the evolution of the continuous
variables. A set of labeled directed edges specify possible
discrete transitions between locations, accompanied by affine
reset map on continuous variables with a bounded additive
disturbance input. Each edge transition is controlled by a set of
linear constraints on the continuous variables, called guards.

In this paper, we consider a specific class of linear constraints
called, sub-parallelotopic, for defining guards and staying conditions,
such that their intersection with the reachable set represented by augmented complex zonotopes (introduced
later) can be effectively computed. The sets corresponding to sub-parallelotopic constraints can be seen as a
generalization of parallelotopes to possibly unbounded sets.  We
discuss the aforementioned intersection operation later after
defining augmented complex zonotopes.
%
\begin{definition}[Sub-parallelotope]~\label{defn:sub-parallelotope} Let
  $K\in\mat{k}{n}{R}$ such that $k\leq n$ and $\lt(KK^T\rt)$ is
  non-singular.  We call such a matrix $K$ a
  \emph{sub-parallelotopic template}.  Let
  $\wh{u},\wh{l}\in\comprealset^n$ such that $\wh{u}\leq\wh{l}$.  Then
  the following is a sub-parallelotopic set.
\[
\sptope{K}{\wh{l}}{\wh{u}} = \lt\{x\in\realset^n: \wh{l}\leq Kx \leq \wh{u}\rt\}
\]
\end{definition}
%
For example, the set of linear constraints $-1\leq x+y-z\leq
1~\wedge~~ x-y+z\leq 3$ is equivalent to a sub-parallelotope
$$\sptope{\ColumnJoin{\lt[1~~~1~-1\rt]}{\lt[1~-1~1\rt]}}{\ColumnJoin{-1}{-\infty}}{\ColumnJoin{1}{3}},$$
because the rows of the sub-parallelotopic template are linearly
independent.  On the other hand, the set of constraints $-1\leq
x+y-z\leq 1~\wedge~~x+y+z\leq 2\wedge~~-1\leq x+y$ do not constitute a
sub-parallelotope, because the three row vectors $\lt[\begin{array}{c
c c}1 & 1 & -1\end{array}\rt]$, $\lt[\begin{array}{c c c}1 & 1 &
1\end{array}\rt]$, and $\lt[\begin{array}{c c c}1 & 1 &
0\end{array}\rt]$ together are linearly dependent. 

%Nevertheless, for many examples of affine hybrid systems, the guards and staying conditions can be specified by sub-parallelotopes.


\tbf{System model.}
We consider discrete-time affine hybrid systems defined by a tuple 
%
\[
\system =
\lt(\locationset,\ptemplate,\stay,\linearmapset,\inputset,\edgeset\rt).
\]
%
Here, $\locationset$ is a finite set of locations.  For each location
$\loc\in\locationset$, a sub-parallelotopic template
$\ptemplate(\loc)\in\mat{k(q)}{n}{\realset}$ is used for defining the
staying conditions and the guards on edges emanating from the
location.  A pair of upper and lower bounds
$\stay(\loc)=\lt(\stay^-(\loc),\stay^+(\loc)\rt)\in\mb{R}^n\times\mb{R}^n:
~~\stay^-(\loc)\leq\stay^+(\loc)$ together with the sub-parallelotopic
template $\ptemplate\lt(\loc\rt)$ define the sub-parallelotopic
staying set
$\sptope{\ptemplate\lt(\loc\rt)}{\stay^-(\loc)}{\stay^+(\loc)}$ in the
location $\loc$.  The maps
$\linearmapset:\locationset\ra\mat{n}{n}{R}$ and
$\inputset:\locationset\ra 2^{\mb{R}^n}$, respectively, give the
linear transfomation and additive input set for all intralocation
transitions.  The set of edges is $\edgeset$, where $\edge\in\edgeset$
is a tuple $\edge =
\lt(\preloc{\edge},\postloc{\edge},\loweredgebound{\edge},\upperedgebound{\edge},\edgemap(\edge),\edgeinp(\edge)\rt)$.  The pre and post locations of the edge are
$\preloc{\edge}\in\locationset$ and $\postloc{\edge}\in\locationset$,
respectively.  The pair of upper and lower bounds
$\lt(\edge^-,\edge^+\rt)\in\realset^{k\lt(\preloc{\edge}\rt)}\times\realset^{k\lt(\preloc{\edge}\rt)}:~~\edge^-\leq\edge^+$,
gives the sub-parallelotopic guard set
$\sptope{\ptemplate\lt(\preloc{\edge}\rt)}{\edge^-}{\edge^+}$, which
is a precondition on the edge transition.  The maps
$\edgemap:\edgeset\ra\mat{n}{n}{R}$ and $\edgeinp:\edgeset\ra
2^{\mb{R}^n}$, respectively, give the linear transfomation and
additive input set for all edge (interlocation) transitions.

\tbf{Dynamics.}
The state of the hybrid system is a pair $(x,\loc)$, where
$x\in\realset^n$ is called the continuous state and
$\loc\in\locationset$ is called the discrete state.  The
evolution of the state of the system in time is called a
\emph{trajectory} of the system.  The trajectory is a function
$\systrj{x}{\loc}:\wholenums\ra\realset^n\times\locationset$, such
that for all $t\in\wholenums$, one of the following is true.

\begin{enumerate}
\item Intralocation dynamics.
\begin{align}~\label{eqn:intralocation}
\begin{split}
& \exists u\in\inputset\lt(\trj{\loc}{t}\rt)~~\text{such that all of
    the following  are collectively true.}\\
& \trj{x}{t+1} = \map(\trj{\loc}{t})+u,~~~\trj{\loc}{t+1} = \trj{\loc}{t}~~
\text{and}\\
& \trj{x}{t},~\trj{x}{t+1}\in\sptope{\ptemplate\lt(\trj{\loc}{t}\rt)}{\stay^-\lt(\trj{\loc}{t}\rt)}{\stay^+\lt(\trj{\loc}{t}\rt)}.
\end{split}
\end{align}
\item Interlocation dynamics.
\begin{align} 
\begin{split}
& \exists \edge\in\edgeset~\text{and}~u\in\edgeinp(\edge)~\text{such
that all of the following are collectively true.}\\
& \trj{\loc}{t}=\preloc{\edge},~~~\trj{x}{t}\in\sptope{\ptemplate\lt(\preloc{\edge}\rt)}{\loweredgebound{\edge}\bigvee\stay^-\lt(\preloc{\edge}\rt)}{\upperedgebound{\edge}\bigwedge\stay^+\lt(\preloc{\edge}\rt)} \\
& \trj{x}{t+1} = \edgemap(\trj{\loc}{t})+u,~~~\trj{\loc}{t+1}
= \postloc{\edge}\\
& \trj{x}{t+1}\in \sptope{\ptemplate\lt(\postloc{\edge}\rt)}{\stay^-\lt(\postloc{\edge}\rt)}{\stay^+\lt(\postloc{\edge}\rt)}.
\end{split}
\end{align}
\end{enumerate}

The set of reachable continuous states in one step of
intralocation and interlocation dynamics, respectively, from a given
set of continuous states is given by the following two functions.
\begin{enumerate}
\item For any location $\loc\in\locationset$, define $\locationtransition{\loc}:2^{\realset^n}\ra 2^{\realset^n}$ as
\begin{equation*}
\locationtransition{q}\lt(S\rt) = \lt\{\Calign{\lt(\map\lt(\loc\rt)\lt(S\bigcap\staysptope{\loc}\rt)\oplus
\inputset\lt(\loc\rt)\rt)}{~~\bigcap~~\staysptope{\loc}}\rt..
\end{equation*}
\item For any edge $\edge\in\edgeset$, define
  $\edgetransition{\edge}:2^{\realset^n}\ra 2^{\realset^n}$ as
\begin{multline*}
\edgetransition{\edge}\lt(S\rt) =  \lt\{\Calign{\lt(\edgemap(\edge)\lt(S\bigcap
\guardsptope{\edge}\rt)\oplus\edgeinp(\edge)\rt)}{~~\bigcap~~\staysptope{\postloc{\edge}}}\rt..
\end{multline*}
\end{enumerate}

We shall identify a set of states by a mapping of the kind
$\hybridset:\locationset\ra 2^{\realset^n}$, called a \emph{state
  set}, which corresponds to the set of states
$\lt\{\lt(x,\loc\rt):x\in\hybridset\lt(\loc\rt)\rt\}$.  A \emph{positive
invariant} is a set of states of the system such that all trajectories
beginning at any state in the positive invariant remain within the
positive invariant.  Equivalently, a state set is a positive invariant
if the reachable set in one time step by both the intralocation and
interlocation dynamics is contained within the original state set.
\begin{definition}
A state set $\hybridset$ is a positive invariant if
the following is true.
\[
 \forall\loc\in\locationset,~~\locationtransition{q}\lt(\hybridset(\loc)\rt) \subseteq \hybridset\lt(\loc\rt)~\label{eqn:pi1}~\text{and}~~
 \forall\edge\in\edgeset,~~\edgetransition{\edge}\lt(\hybridset\lt(\preloc{\edge}\rt)\rt) \subseteq
  \hybridset\lt(\postloc{\edge}\rt).
\]
\end{definition}
