To find positive invariants using augmented complex zonotopes, our
approach is to fix the template vectors and solve for remaining
variables of the augmented complex zonotope that gives a positive
invariant.  For choosing the template, we can be guided by the
eigenstructure, template for guards and staying conditions and some
other aspect of specification of the hybrid system, which we discuss
later.  First, we derive sufficient conditions for finding a
positively invariant augmented complex zonotope, given fixed primary
and secondary templates.

Given an augmented complex zonotope, an overapproximation of its reachable set after one
transition can be computed based on the following two lemmas.
\begin{lemma}
  Let us consider a state set $\hybridset:\locationset\ra\realset^n$ whose projection in each
  location $\loc\in\locationset$ is $\real\lt(\gcz{V(\loc)}{c(\loc)}{s(\loc)}{\pinv{\ptemplate}(\loc)}{l(\loc)}{u(\loc)}\rt)$.
  Let us consider that the
  additive input for an intralocation transition in any location 
  $\loc\in\locationset$ and an interlocation transition along any edge
  $\edge\in\edgeset$, respectively, are
  overapproximated by augmented complex zonotopes as $\inputset(\loc)\subseteq
  \gcz{V^{in}(\loc)}{c^{in}(\loc)}{s^{in}(\loc)}{W^{in}(\loc)}{l^{in}(\loc)}{u^{in}(\loc)}$
  and $\inputset(\edge)\subseteq
  \gcz{V^{in}(\edge)}{c^{in}(\edge)}{s^{in}(\edge)}{W^{in}(\edge)}{l^{in}(\edge)}{u^{in}(\edge)}$.  Then,
\begin{enumerate}
\item For any location $\loc\in\locationset$, the inclusion
  $\locationtransition{\loc}\lt(\hybridset(\loc)\rt)\subseteq
  \hybridset(\loc)$ holds if 
  all of the below conditions are satisfied.
\begin{align}~\label{eqn:locinv}
\begin{split}
& \pinv{\ptemplate}(\loc)c(\loc) = 0~\text{and there exists a complex vector}~
  c^\pr(\loc)~\text{and}\\
& \text{real
    vectors}~s^\pr(\loc),l^\pr(\loc),u^\pr(\loc),l^\dpr(\loc),u^\dpr(\loc)~\text{such
    that}\\
& c^\pr(\loc) = \map(\loc)c(\loc)+c^{in}(\loc),~~s^\pr(\loc) =
  \ColumnJoin{s(\loc)}{s^{in}(\loc)}\\
& l^\pr(\loc) =
  \ColumnJoin{\maxaffine{l(\loc)}{\stay^-(\loc)}}{~~~~~~~~~l^{in}(\loc)~~~},~~u^\pr =
  \ColumnJoin{\minaffine{u(\loc)}{\stay^+(\loc)}}{~~~~~~~~~u^{in}(\loc)~~~}\\
& \lt\{\Calign{\gcz{\lt[\map(\loc)V(\loc)~~V^{in}(\loc)\rt]}{c^\pr(\loc)}{s^\pr(\loc)}
          {\lt[\map(\loc)\pinv{\ptemplate}(\loc)~~W^{in}(\loc)\rt]}{l^\pr(\loc)}{u^\pr(\loc)}}
 {~~\order \gcz{V(\loc)}{c(\loc)}{s(\loc)}{\pinv{\ptemplate}(\loc)}{l^\dpr(\loc)}{u^\dpr(\loc)}}\rt.\\
& \maxaffine{l^\dpr(\loc)}{\stay^-(\loc)}\geq l(\loc)~\text{and}~~
\minaffine{u^\dpr(\loc)}{\stay^+(\loc)}\leq u(\loc).
\end{split}
 \end{align}
\item For any edge $\edge\in\edgeset$, the inclusion
  $\edgetransition{\edge}\lt(\hybridset\lt(\preloc{\edge}\rt)\rt)
  \subseteq \hybridset\lt(\postloc{\edge}\rt)$ holds if 
  all of the below conditions are satisfied.
\begin{align}~\label{eqn:edgeinv}
\begin{split}
& \pinv{\ptemplate}\lt(\preloc{\edge}\rt)c\lt(\preloc{\edge}\rt) =
  0~\text{and there exists a complex
  vector}~c^\pr(\postloc{\edge})~\text{and}\\
& \text{real
    vectors}~s^\pr(\postloc{\edge}),l^\pr(\postloc{\edge}),u^\pr(\postloc{\edge}),l^\dpr(\postloc{\edge}),u^\dpr(\postloc{\edge})~~\text{such
  that}\\
& c^\pr(\edge) = \map(\edge)c(\preloc{\edge})+c^{in}(\edge),~~s^\pr(\edge) =
  \ColumnJoin{s(\preloc{\edge})}{s^{in}(\edge)}\\
& l^\pr(\edge) =
  \ColumnJoin{\maxaffine{l(\preloc{\edge})}{\stay^-(\preloc{\edge})\bigvee\loweredgebound{\edge}}}{~~~~~~~~~l^{in}(\edge)~~~},~~u^\pr =
  \ColumnJoin{\minaffine{u(\preloc{\edge})}{\stay^+(\preloc{\edge})\bigwedge\upperedgebound{\edge}}}{~~~~~~~~~u^{in}(\edge)~~~}\\
& \lt\{\Calign{\gcz{\lt[\map(\edge)V(\preloc{\edge})~~V^{in}(\edge)\rt]}{c^\pr(\edge)}{s^\pr(\edge)}
          {\lt[\map(\edge)\pinv{\ptemplate}(\preloc{\edge})~~W^{in}(\edge)\rt]}{l^\pr(\edge)}{u^\pr(\edge)}}
 {~~\order \gcz{V(\postloc{\edge})}{c(\postloc{\edge})}{s(\postloc{\edge})}{\pinv{\ptemplate}(\postloc{\edge})}{l^\dpr(\edge)}{u^\dpr(\edge)}}\rt.\\
& \maxaffine{l^\dpr(\edge)}{\stay^-(\postloc{\edge})}\geq l(\postloc{\edge})~\text{and}~~
\minaffine{u^\pr(\edge)}{\stay^+(\postloc{\edge})}\leq u(\postloc{\edge}).
\end{split}
\end{align}
\end{enumerate}
\end{lemma}
\begin{proof}
{\color{red} TODO}
\end{proof}

Additionally, the following lemma gives a sufficient condition for the
positive invariant to contain an initial set.
\begin{lemma}
  Let $\mc{I}$ and $\hybridset$ be two state sets whose projections in
  each location $\loc\in\locationset$ are respectively
  $\mc{I}(\loc)=\real\lt(\gcz{V^I(\loc)}{c^I(\loc)}{s^I(\loc)}{W^I(\loc)}{l^I(\loc)}{u^I(\loc)}\rt)$
  and $\hybridset(\loc) =
  \real\lt(\gcz{V(\loc)}{c(\loc)}{s(\loc)}{\pinv{\ptemplate}(\loc)}{l(\loc)}{u(\loc)}\rt)$.
  Then $\forall\loc\in\locationset,~\mc{I}(\loc)\subseteq
  \hybridset(\loc)$ if $\forall\loc\in\locationset$,
\begin{align}~\label{eqn:initcont}
\gcz{V^I(\loc)}{c^I(\loc)}{s^I(\loc)}{W^I(\loc)}{l^I(\loc)}{u^I(\loc)}\order\gcz{V(\loc)}{c(\loc)}{s(\loc)}{\pinv{\ptemplate}(\loc)}{l(\loc)}{u(\loc)}.
\end{align}
\end{lemma}

The following lemma states a sufficient condition for satisfaction of
polytopic safety constraints by the positive invariant.

\begin{lemma}
  Let us consider a state set $\hybridset$ whose projection in each
  location $\loc \in\locationset$ is $\hybridset(\loc) =
  \real\lt(\gcz{V_{n\times
      m(\loc)}(\loc)}{c(\loc)}{s(\loc)}{\pinv{\ptemplate}(\loc)}{l(\loc)}{u(\loc)}\rt)$.
  Let us consider a polytopic state set
  $\safeset:\locationset\ra\realset^n$ described as $\forall
  \loc\in\locationset,~\safeset(\loc)=\polytope{T(\loc)}{d(\loc)}$. Then
  $\forall\loc\in\locationset$, $\hybridset(\loc)\subseteq
  \safeset(\loc)$ if $\forall q\in\locationset$,
\begin{align}~\label{eqn:safecont}
T(\loc)\lt(c(\loc)+\pinv{\ptemplate}(\loc)\lt(\frac{u(\loc)+l(\loc)}{2}\rt)\rt)+\lt|T\lt[V(\loc),~\pinv{\ptemplate}(\loc)\rt]\rt|\ColumnJoin{\hspace{1.5em}s}{\frac{u(\loc)-l(\loc)}{2}}\leq d(\loc).
\end{align}
\end{lemma}

Consolidating the previous results in this section, we state following
sufficient condition for positive invariance along with satisfaction
of given polytopic safety constraints and containment of an initial set.

\begin{theorem}~\label{thm:main} Let $\hybridset$ be a state set whose
  projection in each location $\loc\in\locationset$ is
  $\hybridset(\loc) = \real\lt(\gcz{V_{n\times
      m(\loc)}(\loc)}{c(\loc)}{s(\loc)}{\pinv{\ptemplate}(\loc)}{l(\loc)}{u(\loc)}\rt)$.
  Let the initial set be given as a state set
  $\mc{I}:~\forall\loc\in\locationset$,
  $\mc{I}(\loc)=\real\lt(\gcz{V^I_{n\times m^\pr
  }}{c^I(\loc)}{s^I(\loc)}{W_{n\times
      k^\pr}}{l^I(\loc)}{u^I(\loc)}\rt)$.  Let the polytopic safe set
  be $\safeset:\locationset\ra\realset^n$ described as $\forall
  \loc\in\locationset,~\safeset(\loc)=\polytope{T(\loc)}{d(\loc)}$.
  If $\forall \loc\in\locationset$ and $\forall \edge\in\edgeset$,
  Equations[\ref{eqn:locinv}-\ref{eqn:safecont}] are all
  satisfied, then $\hybridset$ is a positive invariant satisfying the
  safety constraints and containing the initial set.
\end{theorem}
